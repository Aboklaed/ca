<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ar">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>باحث اليوتيوب</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>باحث اليوتيوب<span>برمجة حسين العرياني</span></h1>

    <!-- التبويبات -->
    <div class="tabs">
      <div class="tab" onclick="setCategory('featured')">المحتوى المميز</div>
      <div class="tab" onclick="setCategory('nature')">الطبيعة</div>
      <div class="tab" onclick="setCategory('travel')">السياحة</div>
      <div class="tab" onclick="setCategory('live cameras')">البث المباشر</div>
      <div class="tab" onclick="setCategory('news')">الأخبار</div>
      <div class="tab" onclick="setCategory('movies')">أفلام</div>
    </div>

    <div class="search-box">
      <input type="text" class="search-bar" id="inputBox" placeholder="ابحث عن مقاطع الفيديو على YouTube">
      <button class="search-btn" onclick="search()">🔎</button>
    </div>
    <div id="player-container">
      <div id="player"></div>
    </div>
    <div id="videosResults"></div>
  </div>

  <!-- تضمين مكتبة YouTube Player API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // JavaScript للبحث عن نتائج YouTube بشكل عام بدون استخدام API

    // تعريف متغير عالمي للمشغل
    var player;
    var currentCategory = '';
    var wakeLock = null;

    // دالة لتحديد الفئة المختارة وتحديث نتائج البحث
    function setCategory(category) {
      currentCategory = category;
      var tabs = document.querySelectorAll('.tab');
      for (var i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
      }
      document.querySelector('.tab[onclick="setCategory(\'' + category + '\')"]').classList.add('active');
      search();
    }

    // دالة لبدء تشغيل الفيديو في المشغل المضمن
    function playVideo(videoId) {
      if (player) {
        player.loadVideoById(videoId);
      } else {
        player = new YT.Player('player', {
          height: '180', // انخفاض ارتفاع المشغل ليكون أصغر
          width: '320', // انخفاض عرض المشغل ليكون أصغر
          videoId: videoId,
          events: {
            'onReady': onPlayerReady
          }
        });
      }
      // الانتقال إلى أعلى الصفحة لرؤية الفيديو
      window.scrollTo({ top: 0, behavior: 'smooth' });
      requestWakeLock(); // طلب إبقاء الشاشة مضاءة
    }

    // دالة تشغيل الفيديو عندما يكون المشغل جاهزًا
    function onPlayerReady(event) {
      event.target.playVideo();
    }

    // دالة البحث عن الفيديوهات على YouTube
    function search() {
      var input = document.getElementById('inputBox').value.trim();
      if (input === '' && currentCategory === '') {
        alert('يرجى إدخال مصطلح بحث صالح أو اختيار فئة.');
        return;
      }

      var apiKey = 'AIzaSyC4W3wiKWQ-BkRQPw13Yo0aoI9kQVr_s5Q'; // استبدال بمفتاح الواجهة البرمجية للتطبيق الخاص بك
      var query = input;

      if (currentCategory) {
        var categoryQueries = {
          'featured': 'nature documentaries',
          'nature': 'nature',
          'travel': 'travel Europe',
          'live cameras': 'Live cameras',
          'news': 'Arabic news',
          'movies': 'Foreign movies'
        };
        query = categoryQueries[currentCategory] + (input ? ' ' + input : '');
      }

      var requestUrl = 'https://www.googleapis.com/youtube/v3/search?part=snippet&q=' + encodeURIComponent(query) + '&maxResults=25&key=' + apiKey;

      var xhr = new XMLHttpRequest();
      xhr.open('GET', requestUrl, true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
          var data = JSON.parse(xhr.responseText);
          var videosResults = document.getElementById('videosResults');
          videosResults.innerHTML = '';

          for (var i = 0; i < data.items.length; i++) {
            var item = data.items[i];
            if (item.id.kind === 'youtube#video') {
              var videoId = item.id.videoId;
              var title = item.snippet.title;
              var channelTitle = item.snippet.channelTitle;
              var thumbnailUrl = item.snippet.thumbnails.medium.url;

              var videoItem = document.createElement('div');
              videoItem.classList.add('video-item');

              var thumbnailImg = document.createElement('img');
              thumbnailImg.classList.add('video-thumbnail');
              thumbnailImg.src = thumbnailUrl;
              thumbnailImg.alt = title;
              // جعل الصورة تبدأ الفيديو عند النقر
              thumbnailImg.onclick = (function(videoId) {
                return function() {
                  playVideo(videoId);
                };
              })(videoId);

              // استخدام <span> بدلاً من <a> لعرض العنوان
              var titleElem = document.createElement('span');
              titleElem.classList.add('video-title');
              titleElem.textContent = title;
              titleElem.onclick = (function(videoId) {
                return function() {
                  playVideo(videoId);
                };
              })(videoId);

              var channelElem = document.createElement('p');
              channelElem.classList.add('channel-name');
              channelElem.textContent = channelTitle;

              var downloadBtn = document.createElement('a');
              downloadBtn.classList.add('download-button');
              downloadBtn.textContent = 'تحميل الفيديو';
              var downloadUrl = 'https://www.ssyoutube.com/watch?v=' + videoId;
              downloadBtn.href = downloadUrl;
              downloadBtn.onclick = (function(downloadUrl) {
                return function(event) {
                  event.preventDefault();
                  navigator.clipboard.writeText(downloadUrl).then(function() {
                    window.location.href = downloadUrl;
                  }, function(err) {
                    console.error('فشل في نسخ الرابط:', err);
                  });
                };
              })(downloadUrl);

              // جعل العنصر بأكمله يبدأ الفيديو عند النقر
              videoItem.onclick = (function(videoId) {
                return function() {
                  playVideo(videoId);
                };
              })(videoId);

              videoItem.appendChild(thumbnailImg);
              videoItem.appendChild(titleElem); // استخدام <span> بدلاً من <a>
              videoItem.appendChild(channelElem);
              videoItem.appendChild(downloadBtn);

              videosResults.appendChild(videoItem);
            }
          }
        } else if (xhr.readyState == 4) {
          console.error('حدث خطأ أثناء جلب البيانات:', xhr.statusText);
          alert('حدث خطأ أثناء جلب البيانات. يرجى المحاولة مرة أخرى لاحقًا.');
        }
      };
      xhr.send();
    }

    // إضافة حدث keydown للبحث عند الضغط على Enter
    document.getElementById('inputBox').addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        search();
        event.target.blur(); // إخفاء لوحة المفاتيح بعد البحث
      }
    });

    // دالة لطلب إبقاء الشاشة مضاءة
    function requestWakeLock() {
      if ('wakeLock' in navigator) {
        navigator.wakeLock.request('screen').then(function(lock) {
          wakeLock = lock;
          console.log('Wake Lock is active.');
        }).catch(function(err) {
          console.error('Failed to acquire wake lock:', err);
        });
      }
    }

    // دالة لإطلاق إبقاء الشاشة مضاءة
    function releaseWakeLock() {
      if (wakeLock) {
        wakeLock.release().then(function() {
          console.log('Wake Lock released.');
          wakeLock = null;
        });
      }
    }

    // إطلاق إبقاء الشاشة مضاءة عند إيقاف الفيديو
    window.addEventListener('beforeunload', releaseWakeLock);
  </script>
</body>
</html>
